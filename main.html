<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ê³„ë€ í• ì¸ ì •ë³´</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', 'Apple SD Gothic Neo', Arial, sans-serif;
      margin: 24px;
      color: #222;
    }

    h1 {
      font-size: 22px;
      margin-bottom: 8px;
    }

    .today {
      color: #333;
      margin-bottom: 4px;
    }

    .card {
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 16px;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .promotion-items {
      display: inline-block;
      white-space: nowrap; /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
    }

    .label {
      display: inline-block;
      width: 90px;
      color: #555;
    }

    .error {
      color: #c62828;
      font-weight: 600;
    }

    .hr2 {
      margin: 20px 0;
      border: none;
      border-top: 1px solid #ddd;
    }

  .toggles {
      display: grid;
      grid-template-columns: 1fr; /* 1ì—´ë¡œ ì •ë ¬ (ì„¸ë¡œ ì •ë ¬) */
      gap: 16px; /* í† ê¸€ ê·¸ë£¹ ê°„ê²© */
  }

.toggle-group {
    display: flex; 
    flex-direction: row; /* ë²„íŠ¼ + ì¶œë ¥ ë¶€ë¶„ì´ í•œ ì¤„ë¡œ ì •ë ¬ */
    align-items: center; 
    justify-content: flex-start; /* ì¶œë ¥ ë¶€ë¶„ì€ ë²„íŠ¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ */
    gap: 16px; /* ë²„íŠ¼ê³¼ ì¶œë ¥ ë°ì´í„° ê°„ ê°„ê²© */
    width: 100%; /* ì˜µì…˜: ì›í•˜ëŠ” ë ˆì´ì•„ì›ƒ ë¹„ìœ¨ì„ ì•ˆì •ì ìœ¼ë¡œ ì„¤ì • ê°€ëŠ¥ */
}

.toggle {
    padding: 8px 16px;
    border-radius: 5px;
    border: 1px solid #ddd;
    background-color: #f9f9f9;
    font-size: 18px;
    min-width: 120px; /* ë²„íŠ¼ ê¸°ë³¸ ë„ˆë¹„ */
    text-align: center;
}

.list {
    white-space: pre-wrap; /* ì¤„ë°”ê¿ˆ ìœ ì§€ */
    margin: 0; /* ìƒí•˜ ë§ˆì§„ ì œê±° */
    padding: 8px;
    border: 1px solid #eee;
    border-radius: 5px;
    background: #fff;
    font-size: 16px;
    color: #444;
    width: 50%; /* ê°€ë³€ ë ˆì´ì•„ì›ƒ */
}

    .loading {
      color: #0d64c7;
      margin: 9px 0;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <h1>ì˜¤ëŠ˜ ê³„ë€ í• ì¸ ì •ë³´</h1>
  <div class="today" id="todayText"></div>
  <div id="loadingMsg" class="loading">âŒ›í˜ì´ì§€ê°€ ë¡œë”©ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.<span id="loadingTimer"></span></div>
  <br>

  <!-- <div class="card">
    <div class="row" id="homeplus"><strong>í™ˆí”ŒëŸ¬ìŠ¤</strong></div>
    <div class="row" id="emart"><strong>ì´ë§ˆíŠ¸</strong></div>
    <div class="row" id="lottemart"><strong>ë¡¯ë°ë§ˆíŠ¸</strong></div>
    <div class="row" id="hanaro"><strong>í•˜ë‚˜ë¡œë§ˆíŠ¸</strong></div>
  </div> 
  <hr class="hr2" />-->

<div class="toggles">
  <div class="toggle-group">
    <button class="toggle" data-mart="homeplus">í™ˆí”ŒëŸ¬ìŠ¤</button>
    <div id="homeplusData" class="list"></div>
  </div>
  <div class="toggle-group">
    <button class="toggle" data-mart="emart">ì´ë§ˆíŠ¸</button>
    <div id="emartData" class="list"></div>
  </div>
  <div class="toggle-group">
    <button class="toggle" data-mart="lottemart">ë¡¯ë°ë§ˆíŠ¸</button>
    <div id="lottemartData" class="list"></div>
  </div>
  <div class="toggle-group">
    <button class="toggle" data-mart="hanaro">í•˜ë‚˜ë¡œë§ˆíŠ¸</button>
    <div id="hanaroData" class="list"></div>
  </div>
</div>

<script>
/*
~ì˜ˆì‹œ) í™ˆí”ŒëŸ¬ìŠ¤ ë™ì‘ íë¦„~
DOMContentLoaded ì—ì„œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì¦‰ì‹œ fetchHomeplusData í˜¸ì¶œ
fetch('/api/homeplusData')ë¥¼ í†µí•´ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ response.json() ë°ì´í„°ë¥¼ ë°›ì•„ì˜´
ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ renderHomeplusData ë¡œ ì „ë‹¬í•˜ì—¬ ë°ì´í„°ë¥¼ htmlì— í‘œì‹œ
*/

  function renderHomeplusData(data, targetDivHomeplus) {

      // ë°ì´í„° ë Œë”ë§ ì²˜ë¦¬
      data.forEach(item => {
          const promotionItem = document.createElement("div"); // ê° ë°ì´í„° ì¶œë ¥ì„ ìœ„í•œ div ìƒì„±
          promotionItem.className = "promotion-items"; // í´ë˜ìŠ¤ ì´ë¦„ ì„¤ì •

          // ë°ì´í„° í•„ë“œ ì¶”ì¶œ ë° ì²˜ë¦¬
          const title = item.title || ''; // ì œëª©ì´ ê³µë°±ì¼ ê²½ìš° ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
          const price = item.price || ''; // ê°€ê²©ì´ ê³µë°±ì¼ ê²½ìš° ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
          const discountRate = item.discountRate ? ` (${item.discountRate})` : ''; // í• ì¸ìœ¨ì´ ê³µë°±ì¼ ê²½ìš° ê´„í˜¸ë¥¼ ìƒëµ
          const comment = item.comment || ''; // ì½”ë©˜íŠ¸ê°€ ê³µë°±ì¼ ê²½ìš° ìƒëµ
          // const promotionPeriod = item.promotionPeriod || ''; // í–‰ì‚¬ ê¸°ê°„ì´ ê³µë°±ì¼ ê²½ìš° ìƒëµ

          // ì¶œë ¥ í…ìŠ¤íŠ¸ ìƒì„±
          let displayText = title; // í•„ìˆ˜ í•„ë“œ: ì œëª©

          if (price) {displayText += ` / ${price}ì› ${discountRate}`;} // ê°€ê²© ì¶”ê°€
          if (comment) {displayText += ` / ${comment}`;} // ì½”ë©˜íŠ¸ ì¶”ê°€
          // if (promotionPeriod) {displayText += ` / ${promotionPeriod}`;} // í–‰ì‚¬ ê¸°ê°„ ì¶”ê°€

          // ìµœì¢… í…ìŠ¤íŠ¸ë¥¼ divì— ì„¤ì •
          promotionItem.textContent = displayText;

          // `targetDiv`ì— ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€ (ê¸°ì¡´ ë‚´ìš© ìœ ì§€)
          targetDivHomeplus.appendChild(promotionItem);
          
          // ì¤„ë°”ê¿ˆ íƒœê·¸ ì¶”ê°€
          const lineBreak = document.createElement('br');
          targetDivHomeplus.appendChild(lineBreak);
      });
  }

  async function fetchHomeplusData(targetDivHomeplus) {
      try {
          // API ìš”ì²­ ìˆ˜í–‰
          const response = await fetch('/api/homeplusData');
          
          // ì‘ë‹µìƒíƒœ ì½”ë“œ ë° okìƒíƒœ í™•ì¸
          // console.log("ì‘ë‹µ ìƒíƒœ ì½”ë“œ:", response.status); // HTTP ìƒíƒœ ì½”ë“œ ì¶œë ¥ (200, 404, etc.)
          // console.log("response.ok:", response.ok); // ìƒíƒœ ì½”ë“œê°€ 200~299 ì‚¬ì´ì¸ì§€ í™•ì¸

          if (!response.ok) {
            throw new Error(`ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì‹¤íŒ¨ (ìƒíƒœ ì½”ë“œ: ${response.status})`);
          }

          // ì„œë²„ì˜ ì›ë³¸ ì‘ë‹µ ë°ì´í„° í™•ì¸
          const responseText = await response.text();
          // console.log("ì„œë²„ ì‘ë‹µ ë°ì´í„° (ì›ë³¸):", responseText);

          // JSON ë³€í™˜ 
          const data = responseText ? JSON.parse(responseText) : {};
          // console.log("JSONìœ¼ë¡œ ë³€í™˜ëœ ë°ì´í„°:", data);

          // ë°ì´í„° ì¶”ì¶œ
          const formattedData = Array.isArray(data.filteredItems) ? data.filteredItems : [];
          // console.log("ë Œë”ë§ì— ì‚¬ìš©ë  ë°ì´í„°:", formattedData);

          // ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ
          renderHomeplusData(formattedData, targetDivHomeplus);
      } catch (error) {
          // ì˜¤ë¥˜ ì²˜ë¦¬
          const errorMessage = document.createElement("span");
          errorMessage.style.color = "red";
          errorMessage.textContent = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë„ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
          targetDivHomeplus.appendChild(errorMessage);
          console.error("ë§ˆíŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
      }
  }

  function renderEmartData(data, targetDivEmart) {

      // ë°ì´í„° ë Œë”ë§ ì²˜ë¦¬
      data.forEach(item => {
          const promotionItem = document.createElement("div"); // ê° ë°ì´í„° ì¶œë ¥ì„ ìœ„í•œ div ìƒì„±
          promotionItem.className = "promotion-items"; // í´ë˜ìŠ¤ ì´ë¦„ ì„¤ì •

          // ë°ì´í„° í•„ë“œ ì¶”ì¶œ ë° ì²˜ë¦¬
          const title = item.title || ''; // ì œëª©ì´ ê³µë°±ì¼ ê²½ìš° ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
          const price = item.price || ''; // ê°€ê²©ì´ ê³µë°±ì¼ ê²½ìš° ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
          const discountRate = item.discountRate ? ` (${item.discountRate}%)` : ''; // í• ì¸ìœ¨ì´ ê³µë°±ì¼ ê²½ìš° ê´„í˜¸ë¥¼ ìƒëµ
          const comment = item.comment || ''; // ì½”ë©˜íŠ¸ê°€ ê³µë°±ì¼ ê²½ìš° ìƒëµ
          // const promotionPeriod = item.promotionPeriod || ''; // í–‰ì‚¬ ê¸°ê°„ì´ ê³µë°±ì¼ ê²½ìš° ìƒëµ

          // ì¶œë ¥ í…ìŠ¤íŠ¸ ìƒì„±
          let displayText = title; // í•„ìˆ˜ í•„ë“œ: ì œëª©

          if (price) {displayText += ` / ${price} ${discountRate}`;} // ê°€ê²© ì¶”ê°€
          // if (comment) {displayText += ` / ${comment}`;} // ì½”ë©˜íŠ¸ ì¶”ê°€
          // if (promotionPeriod) {displayText += ` / ${promotionPeriod}`;} // í–‰ì‚¬ ê¸°ê°„ ì¶”ê°€

          // ìµœì¢… í…ìŠ¤íŠ¸ë¥¼ divì— ì„¤ì •
          promotionItem.textContent = displayText;

          // `targetDiv`ì— ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€ (ê¸°ì¡´ ë‚´ìš© ìœ ì§€)
          targetDivEmart.appendChild(promotionItem);
          
          // ì¤„ë°”ê¿ˆ íƒœê·¸ ì¶”ê°€
          const lineBreak = document.createElement('br');
          targetDivEmart.appendChild(lineBreak);
      });
  }

  async function fetchEmartData(targetDivEmart) {
      try {
          // API ìš”ì²­ ìˆ˜í–‰
          const response = await fetch('/api/emartData');

          if (!response.ok) {
            throw new Error(`ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì‹¤íŒ¨ (ìƒíƒœ ì½”ë“œ: ${response.status})`);
          }

          // ì„œë²„ì˜ ì›ë³¸ ì‘ë‹µ ë°ì´í„° í™•ì¸
          const responseText = await response.text();
          // console.log("ì„œë²„ ì‘ë‹µ ë°ì´í„° (ì›ë³¸):", responseText);

          // JSON ë³€í™˜ 
          const data = responseText ? JSON.parse(responseText) : {};
          // console.log("JSONìœ¼ë¡œ ë³€í™˜ëœ ë°ì´í„°:", data);

          // ë°ì´í„° ì¶”ì¶œ
          const formattedData = Array.isArray(data.filteredItems) ? data.filteredItems : [];
          // console.log("ë Œë”ë§ì— ì‚¬ìš©ë  ë°ì´í„°:", formattedData);

          // ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ
          renderEmartData(formattedData, targetDivEmart);
      } catch (error) {
          // ì˜¤ë¥˜ ì²˜ë¦¬
          const errorMessage = document.createElement("span");
          errorMessage.style.color = "red";
          errorMessage.textContent = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë„ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
          targetDivEmart.appendChild(errorMessage);
          console.error("ë§ˆíŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
      }
  }

  function renderLottemartData(data, targetDivLottemart) {

      // ë°ì´í„° ë Œë”ë§ ì²˜ë¦¬
      data.forEach(item => {
          const promotionItem = document.createElement("div"); // ê° ë°ì´í„° ì¶œë ¥ì„ ìœ„í•œ div ìƒì„±
          promotionItem.className = "promotion-items"; // í´ë˜ìŠ¤ ì´ë¦„ ì„¤ì •

          // ë°ì´í„° í•„ë“œ ì¶”ì¶œ ë° ì²˜ë¦¬
          const title = item.title || ''; // ì œëª©ì´ ê³µë°±ì¼ ê²½ìš° ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
          const price = item.price || ''; // ê°€ê²©ì´ ê³µë°±ì¼ ê²½ìš° ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
          // const discountRate = item.discountRate ? ` (${item.discountRate}%)` : ''; // í• ì¸ìœ¨ì´ ê³µë°±ì¼ ê²½ìš° ê´„í˜¸ë¥¼ ìƒëµ
          const comment = item.comment || ''; // ì½”ë©˜íŠ¸ê°€ ê³µë°±ì¼ ê²½ìš° ìƒëµ
          // const promotionPeriod = item.promotionPeriod || ''; // í–‰ì‚¬ ê¸°ê°„ì´ ê³µë°±ì¼ ê²½ìš° ìƒëµ

          // ì¶œë ¥ í…ìŠ¤íŠ¸ ìƒì„±
          let displayText = title; // í•„ìˆ˜ í•„ë“œ: ì œëª©

          if (price) {displayText += ` / ${price}`;} // ê°€ê²© ì¶”ê°€
          if (comment) {displayText += ` / ${comment}`;} // ì½”ë©˜íŠ¸ ì¶”ê°€
          // if (promotionPeriod) {displayText += ` / ${promotionPeriod}`;} // í–‰ì‚¬ ê¸°ê°„ ì¶”ê°€

          // ìµœì¢… í…ìŠ¤íŠ¸ë¥¼ divì— ì„¤ì •
          promotionItem.textContent = displayText;

          // `targetDiv`ì— ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€ (ê¸°ì¡´ ë‚´ìš© ìœ ì§€)
          targetDivLottemart.appendChild(promotionItem);
          
          // ì¤„ë°”ê¿ˆ íƒœê·¸ ì¶”ê°€
          const lineBreak = document.createElement('br');
          targetDivLottemart.appendChild(lineBreak);
      });
  }

  async function fetchLottemartData(targetDivLottemart) {
      try {
          // API ìš”ì²­ ìˆ˜í–‰
          const response = await fetch('/api/lottemartData');

          if (!response.ok) {
            throw new Error(`ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì‹¤íŒ¨ (ìƒíƒœ ì½”ë“œ: ${response.status})`);
          }

          // ì„œë²„ì˜ ì›ë³¸ ì‘ë‹µ ë°ì´í„° í™•ì¸
          const responseText = await response.text();
          // console.log("ì„œë²„ ì‘ë‹µ ë°ì´í„° (ì›ë³¸):", responseText);

          // JSON ë³€í™˜ 
          const data = responseText ? JSON.parse(responseText) : {};
          // console.log("JSONìœ¼ë¡œ ë³€í™˜ëœ ë°ì´í„°:", data);

          // ë°ì´í„° ì¶”ì¶œ
          const formattedData = Array.isArray(data.filteredItems) ? data.filteredItems : [];
          // console.log("ë Œë”ë§ì— ì‚¬ìš©ë  ë°ì´í„°:", formattedData);

          // ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ
          renderLottemartData(formattedData, targetDivLottemart);
      } catch (error) {
          // ì˜¤ë¥˜ ì²˜ë¦¬
          const errorMessage = document.createElement("span");
          errorMessage.style.color = "red";
          errorMessage.textContent = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë„ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
          targetDivLottemart.appendChild(errorMessage);
          console.error("ë§ˆíŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
      }
  }



  // ìš”ì¼ ê³„ì‚° í•¨ìˆ˜ (ìš”ì¼ì„ í•œêµ­ì–´ë¡œ ë°˜í™˜)
  function getDayInKorean(dayIndex) {
        const daysKor = ["ì¼ìš”ì¼", "ì›”ìš”ì¼", "í™”ìš”ì¼", "ìˆ˜ìš”ì¼", "ëª©ìš”ì¼", "ê¸ˆìš”ì¼", "í† ìš”ì¼"];
        return daysKor[dayIndex];
    }

  // ì˜¤ëŠ˜ë‚ ì§œ ë° ë¡œë”© íƒ€ì´ë¨¸ ì„¤ì •
  function initializeDateAndTimer() {
    // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
    const today = new Date();
    const todayTextElement = document.getElementById('todayText');
    const dayKor = getDayInKorean(today.getDay()); // ì˜¤ëŠ˜ ìš”ì¼ (ex: ì›”ìš”ì¼, í™”ìš”ì¼)
    todayTextElement.textContent = `â˜˜ï¸ì˜¤ëŠ˜ ë‚ ì§œ: ${today.getFullYear()}ë…„ ${today.getMonth() + 1}ì›” ${today.getDate()}ì¼ (${dayKor})`;

    // ë¡œë”© íƒ€ì´ë¨¸
    let counter = 0;
    const loadingTimerElement = document.getElementById('loadingTimer');
    const timerInterval = setInterval(() => {
        counter++;
        loadingTimerElement.textContent = ` (${counter}ì´ˆ)`;
    }, 1000);

    return timerInterval;
} 
    
  // DOMContentLoaded ì´ë²¤íŠ¸: í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
  document.addEventListener('DOMContentLoaded', async () => {

      // ë‚ ì§œ, íƒ€ì´ë¨¸ í˜¸ì¶œ
      const timerInterval = initializeDateAndTimer();

      // ë°ì´í„° ë¡œë”©
      const targetDivHomeplus = document.getElementById('homeplusData');
      const targetDivEmart = document.getElementById('emartData');
      const targetDivLottemart = document.getElementById('lottemartData');

      // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      await fetchHomeplusData(targetDivHomeplus);
      await fetchEmartData(targetDivEmart);
      await fetchLottemartData(targetDivLottemart);

      const loadingMessageElement = document.getElementById('loadingMsg');
      loadingMessageElement.textContent = "ğŸ”½ ì•„ë˜ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.";
      clearInterval(timerInterval); // íƒ€ì´ë¨¸ ì¤‘ì§€
  });

  </script>
</body>

</html>