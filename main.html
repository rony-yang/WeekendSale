<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ê³„ë€ í• ì¸ ì •ë³´</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', 'Apple SD Gothic Neo', Arial, sans-serif;
      margin: 24px;
      color: #222;
    }

    h1 {
      font-size: 22px;
      margin-bottom: 8px;
    }

    .today {
      color: #333;
      margin-bottom: 4px;
    }

    .card {
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 16px;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .promotion-items {
      display: inline-block;
      white-space: nowrap;
      /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
    }

    .label {
      display: inline-block;
      width: 90px;
      color: #555;
    }

    .error {
      color: #c62828;
      font-weight: 600;
    }

    .toggles {
      display: grid;
      grid-template-columns: 1fr;
      /* 1ì—´ë¡œ ì •ë ¬ (ì„¸ë¡œ ì •ë ¬) */
      gap: 16px;
      /* í† ê¸€ ê·¸ë£¹ ê°„ê²© */
    }

    .toggle-group {
      display: flex;
      flex-direction: row;
      /* ë²„íŠ¼ + ì¶œë ¥ ë¶€ë¶„ì´ í•œ ì¤„ë¡œ ì •ë ¬ */
      align-items: center;
      justify-content: flex-start;
      /* ì¶œë ¥ ë¶€ë¶„ì€ ë²„íŠ¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ */
      gap: 16px;
      /* ë²„íŠ¼ê³¼ ì¶œë ¥ ë°ì´í„° ê°„ ê°„ê²© */
      width: 100%;
      /* ì˜µì…˜: ì›í•˜ëŠ” ë ˆì´ì•„ì›ƒ ë¹„ìœ¨ì„ ì•ˆì •ì ìœ¼ë¡œ ì„¤ì • ê°€ëŠ¥ */
    }

    .toggle {
      padding: 8px 16px;
      border-radius: 5px;
      border: 1px solid #ddd;
      background-color: #f9f9f9;
      font-size: 18px;
      min-width: 120px;
      /* ë²„íŠ¼ ê¸°ë³¸ ë„ˆë¹„ */
      text-align: center;
    }

    .list {
      white-space: pre-wrap;
      /* ì¤„ë°”ê¿ˆ ìœ ì§€ */
      margin: 0;
      /* ìƒí•˜ ë§ˆì§„ ì œê±° */
      padding: 8px;
      border: 1px solid #eee;
      border-radius: 5px;
      background: #fff;
      font-size: 16px;
      color: #444;
      width: 50%;
      /* ê°€ë³€ ë ˆì´ì•„ì›ƒ */
    }

    .loading {
      color: #0d64c7;
      margin: 9px 0;
      font-weight: bold;
    }
/* ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™” */
.container {
  display: flex;
  justify-content: space-between;
  width: 100%;
  gap: 20px;
  padding: 20px;
}

/* ê°ê°ì˜ ì ˆë°˜ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
.half-section {
  flex: 1;
  padding: 15px;
  background-color: #f9f9f9;
  border: 1px solid #ddd;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

/* ìµœì €ê°€ ê°•ì¡° ìŠ¤íƒ€ì¼ */
.highlight {
  font-weight: bold;
  color: #0d64c7;
  font-size: 18px;
  margin-bottom: 10px;
}

/* ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
.product-list {
  list-style-type: none;
  padding: 0;
  margin: 10px 0 0 0;
}

.product-list li {
  padding: 8px;
  margin-bottom: 5px;
  background-color: #fff;
  border: 1px solid #ddd;
  border-radius: 5px;
}

.product-list li:nth-child(odd) {
  background-color: #f3f3f3;
}

  </style>
</head>

<body>
  <h1>ì˜¤ëŠ˜ ê³„ë€ í• ì¸ ì •ë³´</h1>
  <div class="today" id="todayText"></div>
  <div id="loadingMsg" class="loading">âŒ›í˜ì´ì§€ê°€ ë¡œë”©ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.(10ì´ˆ ì´ìƒ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.)
    <span id="loadingTimer"></span>
  </div>
  <br>

  <div class="toggles">
    <div class="toggle-group">
      <button class="toggle" data-mart="homeplus">í™ˆí”ŒëŸ¬ìŠ¤</button>
      <div id="homeplusData" class="list"></div>
    </div>
    <div class="toggle-group">
      <button class="toggle" data-mart="emart">ì´ë§ˆíŠ¸</button>
      <div id="emartData" class="list"></div>
    </div>
    <div class="toggle-group">
      <button class="toggle" data-mart="lottemart">ë¡¯ë°ë§ˆíŠ¸</button>
      <div id="lottemartData" class="list"></div>
    </div>
  </div>
  <br>
  <hr>
  <br>

  <div class="container">
    <!-- ì™¼ìª½ ì˜ì—­: ëŒ€ë€ -->
    <div class="half-section" id="left-section">
      <h2>ëŒ€ë€</h2>
      <p class="highlight">ìµœì €ê°€ğŸ‘‰ <span id="lowProductMiddleEgg"></span></p>
      <ul id="middleEggList" class="product-list"></ul>
    </div>

    <!-- ì˜¤ë¥¸ìª½ ì˜ì—­: íŠ¹ë€ -->
    <div class="half-section" id="right-section">
      <h2>íŠ¹ë€</h2>
      <p class="highlight">ìµœì €ê°€ğŸ‘‰ <span id="lowProductBigEgg"></span></p>
      <ul id="BigEggList" class="product-list"></ul>
    </div>
  </div>

  <script>
    /*
    ~ì˜ˆì‹œ) í™ˆí”ŒëŸ¬ìŠ¤ ë™ì‘ íë¦„~
    DOMContentLoaded ì—ì„œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì¦‰ì‹œ fetchHomeplusData í˜¸ì¶œ
    fetch('/api/homeplusData')ë¥¼ í†µí•´ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ response.json() ë°ì´í„°ë¥¼ ë°›ì•„ì˜´
    ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ renderHomeplusData ë¡œ ì „ë‹¬í•˜ì—¬ ë°ì´í„°ë¥¼ htmlì— í‘œì‹œ
    */

    const allItems = []; // ê°’ ë¹„êµë¥¼ ìœ„í•œ ì „ì²´ ë°ì´í„° ëª¨ìŒ

    function renderHomeplusData(data, targetDivHomeplus) {

      // ë°ì´í„° ë Œë”ë§ ì²˜ë¦¬
      data.forEach(item => {
        const promotionItem = document.createElement("div"); // ê° ë°ì´í„° ì¶œë ¥ì„ ìœ„í•œ div ìƒì„±
        promotionItem.className = "promotion-items"; // í´ë˜ìŠ¤ ì´ë¦„ ì„¤ì •

        // ë°ì´í„° í•„ë“œ ì¶”ì¶œ ë° ì²˜ë¦¬
        const title = item.title || ''; // ì œëª©ì´ ê³µë°±ì¼ ê²½ìš° ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
        const price = item.price ? new Intl.NumberFormat('en-US').format(item.price) : ''; // ê°€ê²©ì´ ê³µë°±ì¼ ê²½ìš° ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
        const discountRate = item.discountRate ? ` (${item.discountRate})` : ''; // í• ì¸ìœ¨ì´ ê³µë°±ì¼ ê²½ìš° ê´„í˜¸ë¥¼ ìƒëµ
        const comment = item.comment || ''; // ì½”ë©˜íŠ¸ê°€ ê³µë°±ì¼ ê²½ìš° ìƒëµ
        // const promotionPeriod = item.promotionPeriod || ''; // í–‰ì‚¬ ê¸°ê°„ì´ ê³µë°±ì¼ ê²½ìš° ìƒëµ

        // ì¶œë ¥ í…ìŠ¤íŠ¸ ìƒì„±
        let displayText = title; // í•„ìˆ˜ í•„ë“œ: ì œëª©

        if (price) { displayText += ` / ${price}ì› ${discountRate}`; } // ê°€ê²© ì¶”ê°€
        if (comment) { displayText += ` / ${comment}`; } // ì½”ë©˜íŠ¸ ì¶”ê°€
        // if (promotionPeriod) {displayText += ` / ${promotionPeriod}`;} // í–‰ì‚¬ ê¸°ê°„ ì¶”ê°€

        allItems.push({ mart: "í™ˆí”ŒëŸ¬ìŠ¤", title, price }); // ê°’ ë¹„êµë¥¼ ìœ„í•œ ì „ì²´ ë°ì´í„° ëª¨ìœ¼ê¸°

        // ìµœì¢… í…ìŠ¤íŠ¸ë¥¼ divì— ì„¤ì •
        promotionItem.textContent = displayText;

        // `targetDiv`ì— ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€ (ê¸°ì¡´ ë‚´ìš© ìœ ì§€)
        targetDivHomeplus.appendChild(promotionItem);

        // ì¤„ë°”ê¿ˆ íƒœê·¸ ì¶”ê°€
        const lineBreak = document.createElement('br');
        targetDivHomeplus.appendChild(lineBreak);
      });
    }

    async function fetchHomeplusData(targetDivHomeplus) {
      try {
        // API ìš”ì²­ ìˆ˜í–‰
        const response = await fetch('/api/homeplusData');

        // ì‘ë‹µìƒíƒœ ì½”ë“œ ë° okìƒíƒœ í™•ì¸
        // console.log("ì‘ë‹µ ìƒíƒœ ì½”ë“œ:", response.status); // HTTP ìƒíƒœ ì½”ë“œ ì¶œë ¥ (200, 404, etc.)
        // console.log("response.ok:", response.ok); // ìƒíƒœ ì½”ë“œê°€ 200~299 ì‚¬ì´ì¸ì§€ í™•ì¸

        if (!response.ok) {
          throw new Error(`ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì‹¤íŒ¨ (ìƒíƒœ ì½”ë“œ: ${response.status})`);
        }

        // ì„œë²„ì˜ ì›ë³¸ ì‘ë‹µ ë°ì´í„° í™•ì¸
        const responseText = await response.text();
        //console.log("ì„œë²„ ì‘ë‹µ ë°ì´í„° (ì›ë³¸):", responseText);

        // JSON ë³€í™˜ 
        const data = responseText ? JSON.parse(responseText) : {};
        //console.log("JSONìœ¼ë¡œ ë³€í™˜ëœ ë°ì´í„°:", data);

        // ë°ì´í„° ì¶”ì¶œ
        const formattedData = Array.isArray(data) ? data : [];
        console.log("ë Œë”ë§ì— ì‚¬ìš©ë  í™ˆí”ŒëŸ¬ìŠ¤ ë°ì´í„°:", formattedData);

        // ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ
        renderHomeplusData(formattedData, targetDivHomeplus);
      } catch (error) {
        // ì˜¤ë¥˜ ì²˜ë¦¬
        const errorMessage = document.createElement("span");
        errorMessage.style.color = "red";
        errorMessage.textContent = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë„ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        targetDivHomeplus.appendChild(errorMessage);
        console.error("ë§ˆíŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
      }
    }

    function renderEmartData(data, targetDivEmart) {

      // ë°ì´í„° ë Œë”ë§ ì²˜ë¦¬
      data.forEach(item => {
        const promotionItem = document.createElement("div"); // ê° ë°ì´í„° ì¶œë ¥ì„ ìœ„í•œ div ìƒì„±
        promotionItem.className = "promotion-items"; // í´ë˜ìŠ¤ ì´ë¦„ ì„¤ì •

        // ë°ì´í„° í•„ë“œ ì¶”ì¶œ ë° ì²˜ë¦¬
        const title = item.title || ''; // ì œëª©ì´ ê³µë°±ì¼ ê²½ìš° ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
        const price = item.price || ''; // ê°€ê²©ì´ ê³µë°±ì¼ ê²½ìš° ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
        const discountRate = item.discountRate ? ` (${item.discountRate}%)` : ''; // í• ì¸ìœ¨ì´ ê³µë°±ì¼ ê²½ìš° ê´„í˜¸ë¥¼ ìƒëµ
        const comment = item.comment || ''; // ì½”ë©˜íŠ¸ê°€ ê³µë°±ì¼ ê²½ìš° ìƒëµ
        // const promotionPeriod = item.promotionPeriod || ''; // í–‰ì‚¬ ê¸°ê°„ì´ ê³µë°±ì¼ ê²½ìš° ìƒëµ

        // ì¶œë ¥ í…ìŠ¤íŠ¸ ìƒì„±
        let displayText = title; // í•„ìˆ˜ í•„ë“œ: ì œëª©

        if (price) { displayText += ` / ${price} ${discountRate}`; } // ê°€ê²© ì¶”ê°€
        // if (comment) {displayText += ` / ${comment}`;} // ì½”ë©˜íŠ¸ ì¶”ê°€
        // if (promotionPeriod) {displayText += ` / ${promotionPeriod}`;} // í–‰ì‚¬ ê¸°ê°„ ì¶”ê°€

        allItems.push({ mart: "ì´ë§ˆíŠ¸", title, price }); // ê°’ ë¹„êµë¥¼ ìœ„í•œ ì „ì²´ ë°ì´í„° ëª¨ìœ¼ê¸°

        // ìµœì¢… í…ìŠ¤íŠ¸ë¥¼ divì— ì„¤ì •
        promotionItem.textContent = displayText;

        // `targetDiv`ì— ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€ (ê¸°ì¡´ ë‚´ìš© ìœ ì§€)
        targetDivEmart.appendChild(promotionItem);

        // ì¤„ë°”ê¿ˆ íƒœê·¸ ì¶”ê°€
        const lineBreak = document.createElement('br');
        targetDivEmart.appendChild(lineBreak);
      });
    }

    async function fetchEmartData(targetDivEmart) {
      try {
        // API ìš”ì²­ ìˆ˜í–‰
        const response = await fetch('/api/emartData');

        if (!response.ok) {
          throw new Error(`ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì‹¤íŒ¨ (ìƒíƒœ ì½”ë“œ: ${response.status})`);
        }

        // ì„œë²„ì˜ ì›ë³¸ ì‘ë‹µ ë°ì´í„° í™•ì¸
        const responseText = await response.text();
        // console.log("ì„œë²„ ì‘ë‹µ ë°ì´í„° (ì›ë³¸):", responseText);

        // JSON ë³€í™˜ 
        const data = responseText ? JSON.parse(responseText) : {};
        // console.log("JSONìœ¼ë¡œ ë³€í™˜ëœ ë°ì´í„°:", data);

        // ë°ì´í„° ì¶”ì¶œ
        const formattedData = Array.isArray(data) ? data : [];
        console.log("ë Œë”ë§ì— ì‚¬ìš©ë  ì´ë§ˆíŠ¸ ë°ì´í„°:", formattedData);

        // ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ
        renderEmartData(formattedData, targetDivEmart);
      } catch (error) {
        // ì˜¤ë¥˜ ì²˜ë¦¬
        const errorMessage = document.createElement("span");
        errorMessage.style.color = "red";
        errorMessage.textContent = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë„ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        targetDivEmart.appendChild(errorMessage);
        console.error("ë§ˆíŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
      }
    }

    function renderLottemartData(data, targetDivLottemart) {

      // ë°ì´í„° ë Œë”ë§ ì²˜ë¦¬
      data.forEach(item => {
        const promotionItem = document.createElement("div"); // ê° ë°ì´í„° ì¶œë ¥ì„ ìœ„í•œ div ìƒì„±
        promotionItem.className = "promotion-items"; // í´ë˜ìŠ¤ ì´ë¦„ ì„¤ì •

        // ë°ì´í„° í•„ë“œ ì¶”ì¶œ ë° ì²˜ë¦¬
        const title = item.title || ''; // ì œëª©ì´ ê³µë°±ì¼ ê²½ìš° ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
        const price = item.price || ''; // ê°€ê²©ì´ ê³µë°±ì¼ ê²½ìš° ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
        // const discountRate = item.discountRate ? ` (${item.discountRate}%)` : ''; // í• ì¸ìœ¨ì´ ê³µë°±ì¼ ê²½ìš° ê´„í˜¸ë¥¼ ìƒëµ
        const comment = item.comment || ''; // ì½”ë©˜íŠ¸ê°€ ê³µë°±ì¼ ê²½ìš° ìƒëµ
        // const promotionPeriod = item.promotionPeriod || ''; // í–‰ì‚¬ ê¸°ê°„ì´ ê³µë°±ì¼ ê²½ìš° ìƒëµ

        // ì¶œë ¥ í…ìŠ¤íŠ¸ ìƒì„±
        let displayText = title; // í•„ìˆ˜ í•„ë“œ: ì œëª©

        if (price) { displayText += ` / ${price}`; } // ê°€ê²© ì¶”ê°€
        if (comment) { displayText += ` / ${comment}`; } // ì½”ë©˜íŠ¸ ì¶”ê°€
        // if (promotionPeriod) {displayText += ` / ${promotionPeriod}`;} // í–‰ì‚¬ ê¸°ê°„ ì¶”ê°€

        allItems.push({ mart: "ë¡¯ë°ë§ˆíŠ¸", title, price }); // ê°’ ë¹„êµë¥¼ ìœ„í•œ ì „ì²´ ë°ì´í„° ëª¨ìœ¼ê¸°

        // ìµœì¢… í…ìŠ¤íŠ¸ë¥¼ divì— ì„¤ì •
        promotionItem.textContent = displayText;

        // `targetDiv`ì— ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€ (ê¸°ì¡´ ë‚´ìš© ìœ ì§€)
        targetDivLottemart.appendChild(promotionItem);

        // ì¤„ë°”ê¿ˆ íƒœê·¸ ì¶”ê°€
        const lineBreak = document.createElement('br');
        targetDivLottemart.appendChild(lineBreak);
      });
    }

    async function fetchLottemartData(targetDivLottemart) {
      try {
        // API ìš”ì²­ ìˆ˜í–‰
        const response = await fetch('/api/lottemartData');

        if (!response.ok) {
          throw new Error(`ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì‹¤íŒ¨ (ìƒíƒœ ì½”ë“œ: ${response.status})`);
        }

        // ì„œë²„ì˜ ì›ë³¸ ì‘ë‹µ ë°ì´í„° í™•ì¸
        const responseText = await response.text();
        // console.log("ì„œë²„ ì‘ë‹µ ë°ì´í„° (ì›ë³¸):", responseText);

        // JSON ë³€í™˜ 
        const data = responseText ? JSON.parse(responseText) : {};
        // console.log("JSONìœ¼ë¡œ ë³€í™˜ëœ ë°ì´í„°:", data);

        // ë°ì´í„° ì¶”ì¶œ
        const formattedData = Array.isArray(data) ? data : [];
        console.log("ë Œë”ë§ì— ì‚¬ìš©ë  ë¡¯ë°ë§ˆíŠ¸ ë°ì´í„°:", formattedData);

        // ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ
        renderLottemartData(formattedData, targetDivLottemart);
      } catch (error) {
        // ì˜¤ë¥˜ ì²˜ë¦¬
        const errorMessage = document.createElement("span");
        errorMessage.style.color = "red";
        errorMessage.textContent = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë„ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        targetDivLottemart.appendChild(errorMessage);
        console.error("ë§ˆíŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
      }
    }


    // ìš”ì¼ ê³„ì‚° í•¨ìˆ˜ (ìš”ì¼ì„ í•œêµ­ì–´ë¡œ ë°˜í™˜)
    function getDayInKorean(dayIndex) {
      const daysKor = ["ì¼ìš”ì¼", "ì›”ìš”ì¼", "í™”ìš”ì¼", "ìˆ˜ìš”ì¼", "ëª©ìš”ì¼", "ê¸ˆìš”ì¼", "í† ìš”ì¼"];
      return daysKor[dayIndex];
    }

    // ì˜¤ëŠ˜ë‚ ì§œ ë° ë¡œë”© íƒ€ì´ë¨¸ ì„¤ì •
    function initializeDateAndTimer() {
      // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
      const today = new Date();
      const todayTextElement = document.getElementById('todayText');
      const dayKor = getDayInKorean(today.getDay()); // ì˜¤ëŠ˜ ìš”ì¼ (ex: ì›”ìš”ì¼, í™”ìš”ì¼)
      todayTextElement.textContent = `â˜˜ï¸ì˜¤ëŠ˜ ë‚ ì§œ: ${today.getFullYear()}ë…„ ${today.getMonth() + 1}ì›” ${today.getDate()}ì¼ (${dayKor})`;

      // ë¡œë”© íƒ€ì´ë¨¸
      let counter = 0;
      const loadingTimerElement = document.getElementById('loadingTimer');
      const timerInterval = setInterval(() => {
        counter++;
        loadingTimerElement.textContent = ` (${counter}ì´ˆ)`;
      }, 1000);

      return timerInterval;
    }

    // ì „ì²´ ìƒí’ˆ ê°€ê²© ë¹„êµí•´ì„œ ìµœì €ê°€ ì°¾ê¸°
    function displayLowestPriceProducts(products, isSpecial, lowProductId, listId) {
      // "íŠ¹ë€" ë˜ëŠ” "íŠ¹" í¬í•¨ ì—¬ë¶€ì— ë”°ë¼ ìƒí’ˆ í•„í„°ë§
      const filteredProducts = products.filter(product => {
        const title = product.title || "";

        if (isSpecial) {
          // "íŠ¹"ì´ë‚˜ "íŠ¹ë€" í¬í•¨ëœ ìƒí’ˆ
          return title.includes("íŠ¹ë€") || title.includes("íŠ¹");
        } else {
          // "íŠ¹"ì´ë‚˜ "íŠ¹ë€"ì´ í¬í•¨ë˜ì§€ ì•Šì€ ìƒí’ˆ (ì¦‰, ëŒ€ë€)
          return !title.includes("íŠ¹ë€") && !title.includes("íŠ¹");
        }
      });

      // console.log(`${isSpecial ? "[íŠ¹ë€]" : "[ëŒ€ë€]"} í•„í„° ê²°ê³¼: ${filteredProducts.length}ê°œ`);
      // filteredProducts.forEach(p => console.log(`  - ${p.mart} | ${p.title} | ${p.price}`));

      // í•„í„°ë§ëœ ìƒí’ˆì´ ì—†ì„ ê²½ìš°
      if (filteredProducts.length === 0) {
        console.warn(`${isSpecial ? "íŠ¹ë€" : "ëŒ€ë€"} ê´€ë ¨ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.`);
        document.getElementById(lowProductId).textContent = "ìƒí’ˆ ì—†ìŒ";
        return;
      }

      // ê°€ê²© ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
      const sortedProducts = filteredProducts.sort((a, b) => {
        const priceA = parseInt(a.price.replace(/[^0-9]/g, ''), 10);
        const priceB = parseInt(b.price.replace(/[^0-9]/g, ''), 10);
        return priceA - priceB;
      });

      // "í™ˆí”ŒëŸ¬ìŠ¤" ìƒí’ˆì˜ ê°€ê²©ë§Œ í‘œì‹œ í˜•ì‹ ìˆ˜ì •
      sortedProducts.forEach(product => {
        // ê°€ê²© ë¬¸ìì—´ì—ì„œ ìˆ«ìë§Œ ì¶”ì¶œ
        const numericPrice = parseInt(product.price.replace(/[^0-9]/g, ''), 10);

        // ì¡°ê±´: "í™ˆí”ŒëŸ¬ìŠ¤" ìƒí’ˆì— ëŒ€í•´ ì ìš©
        if (product.mart === "í™ˆí”ŒëŸ¬ìŠ¤") {
          // 3ìë¦¬ë§ˆë‹¤ ì‰¼í‘œ ì¶”ê°€ ë° "ì›" ë¶™ì´ê¸°
          product.price = `${numericPrice.toLocaleString()}ì›`;
        }
      });

      // ìµœì €ê°€ ìƒí’ˆ (ì²« ë²ˆì§¸ í•­ëª©)
      const lowestProduct = sortedProducts[0];

      // ìµœì €ê°€ ìƒí’ˆ HTML ì—…ë°ì´íŠ¸
      updateHTMLElement(lowProductId, lowestProduct);

      // ëª©ë¡ì— ì •ë ¬ëœ ìƒí’ˆë“¤ ì¶œë ¥
      appendProductsList(listId, sortedProducts);
    }

    // HTML ìš”ì†Œì— ê°’ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
    function updateHTMLElement(elementId, product) {
      // ì§€ì •ëœ HTML ìš”ì†Œì— í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
      const element = document.getElementById(elementId);
      if (element && product) {
        element.textContent = `[${product.mart}] ${product.title} / ${product.price}`;
      }
    }

    function appendProductsList(listId, products) {
      const listElement = document.getElementById(listId);
      listElement.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

      products.forEach(product => {
        const listItem = document.createElement("li");
        listItem.textContent = `[${product.mart}] ${product.title} / ${product.price}`;
        listElement.appendChild(listItem);
      });
    }

    // DOMContentLoaded ì´ë²¤íŠ¸: í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    document.addEventListener('DOMContentLoaded', async () => {

      // ë‚ ì§œ, íƒ€ì´ë¨¸ í˜¸ì¶œ
      const timerInterval = initializeDateAndTimer();

      // ë°ì´í„° ë¡œë”©
      const targetDivHomeplus = document.getElementById('homeplusData');
      const targetDivEmart = document.getElementById('emartData');
      const targetDivLottemart = document.getElementById('lottemartData');

      // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      await fetchHomeplusData(targetDivHomeplus);
      await fetchEmartData(targetDivEmart);
      await fetchLottemartData(targetDivLottemart);

      // console.log('--í™•ì¸ìš©--');
      // console.log(allItems);

      // ëŒ€ë€ ì •ë³´ í‘œì‹œ
      displayLowestPriceProducts(allItems, false, "lowProductMiddleEgg", "middleEggList");

      // íŠ¹ë€ ì •ë³´ í‘œì‹œ
      displayLowestPriceProducts(allItems, true, "lowProductBigEgg", "BigEggList");

      const loadingMessageElement = document.getElementById('loadingMsg');
      loadingMessageElement.textContent = "ğŸ”½ ì•„ë˜ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.";
      clearInterval(timerInterval); // íƒ€ì´ë¨¸ ì¤‘ì§€
    });

  </script>
</body>

</html>